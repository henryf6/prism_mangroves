{
    "collab_server" : "",
    "contents" : "## ******************************************************************** ##\n## mangrove_deriv_analysis.R \n##\n## Author: Henry Frye\n## Date Created: Aug 29 2019\n##\n##\n## Purpose:\n## Spectral derivative analysis\n## ******************************************************************** ##\n\n## ******************************************************************** ##\n####Set Up####\n## ******************************************************************** ##\nrm(list = ls())\n\n# Set working directory\nif(Sys.info()['user']=='henryfrye') setwd(\"/Users/henryfrye/Dropbox/Intellectual_Endeavours/UConn/Research/phd_research/chapter_2\")\n\n# Loading Packages\nlibrary(tidyverse)\nlibrary(ggthemes)\nlibrary(reshape2)\nlibrary(hsdar)\n\n\n# Load Data\nblack <- read.csv(file = 'mangrove_data/Leaf_spectra/blackMangroves_leaves.csv')\nred <- read.csv(file = 'mangrove_data/Leaf_spectra/redMangroves_leaves.csv')\nwhite <- read.csv(file = 'mangrove_data/Leaf_spectra/whiteMangroves_leaves.csv')\n\n#transpose data format (run once only or re-run with removing objects)\nbt <- t(black)\ncolnames(bt) <- bt[1,]\nblack <- bt[-1,]\n\nrt <- t(red)\ncolnames(rt) <- rt[1,]\nred <- rt[-1,]\n\nwt <- t(white)\ncolnames(wt) <- wt[1,]\nwhite <- wt[-1,]\n\n#merge all data into one dataframe\nall_spp <- rbind(black,white,red)\nall_spp <- as.data.frame(all_spp)\nall_spp$species <- c(rep(\"black\",20), rep(\"white\",20), rep(\"red\",20) )\nall_spp <- all_spp %>% dplyr::select(species,'350':'2500')\n\n## ******************************************************************** ##\n####Spectral Reading####\n## ******************************************************************** ##\nmangrove.spec <- speclib(as.matrix(all_spp[,2:1402]),350:1750)\nSI(mangrove.spec) <- all_spp$species\n\n\n# meanflt.white <- noiseFiltering(white.spec, method = \"mean\", p = 19)\n# plot(meanflt.white)\n# plot(white.spec, FUN = 1, col = \"red\")\n\nmangrove.spec <- noiseFiltering(mangrove.spec, method = \"mean\", p = 15)\nmask(mangrove.spec) <- c(1325,1500)\n\n\nsp_red <- subset(mangrove.spec, V1 == \"red\")\nsp_black <- subset(mangrove.spec, V1 == \"black\")\nsp_white <- subset(mangrove.spec, V1 == \"white\")\n\npng(\"mangrove_figures/species_spectra.png\")\nplot(sp_red, col = \"darkred\", ylim = c(0,1), main = \"Mean Species Reflectance\", lwd = 2)\nplot(sp_black, col = \"black\",new = FALSE, lwd = 2)\nplot(sp_white, col = \"blue\",new = FALSE, lwd = 2)\ndev.off()\n\n## ******************************************************************** ##\n####Band Depth Index####\n## ******************************************************************** ##\n#convex hull continuum removal transformation\nch_bd.r <- transformSpeclib(sp_red, method = \"ch\")\nch_bd.b <- transformSpeclib(sp_black, method = \"ch\")\nch_bd.w <- transformSpeclib(sp_white, method = \"ch\")\nch_bd.all <- transformSpeclib(mangrove.spec, method = \"ch\")\n\n\npng(\"mangrove_figures/band_index.png\")\nplot(ch_bd.r, col = \"darkred\", main = \"Band depth\", lwd = 2)\nplot(ch_bd.b, col = \"black\", main = \"Band depth\", new = FALSE, lwd = 2)\nplot(ch_bd.w,col = \"blue\", main = \"Band depth\", new = FALSE, lwd = 2)\nabline(v = 484, col = \"red\")\nabline(v = 667, col = \"red\")\n#abline(v = 797, col = \"red\")\n#abline(v = 865, col = \"red\")\nabline(v = 976, col = \"red\")\nabline(v = 1181, col = \"red\")\ndev.off()\n#\n#getcp(ch_cline,2)\n\nplot(ch_bd.all,col = \"blue\", main = \"Band depth\")\n#explore highest band depths\nmean.band<- colMeans(ch_bd.all@spectra@spectra_ma)\nattributes(mean.band)$names <- c(350:1325,1500:1750)\n#based on band depths, 484, 667, 976 and 1181 appear to be of interest \n#run function below\nwhich.peaks(mean.band)\n\n\n## ******************************************************************** ##\n####Absorption feature extraction####\n## ******************************************************************** ##\nfeatureSelection <- specfeat(ch_bd.all, c(480,780, 975, 1150))\nplot(featureSelection, fnumber = 1:4)\n\n## Calculate properties of features\nfeatureProp <- feature_properties(featureSelection)\n\nsp_feat <- as.data.frame(SI(featureProp))\n\nggplot(sp_feat, aes(y = f480_maxwl, color = V1)) + geom_boxplot()\n\n\n## ******************************************************************** ##\n####Find an index####\n## ******************************************************************** ##\n\n# Calculate normalized band depth index for first feature\nfeatureSelection_bdri <- bdri(featureSelection, 3, index = \"ndbi\")\n\n## Plot result\nplot(featureSelection_bdri)\n\n## ******************************************************************** ##\n####Within and out group average spectral angles for entire spectrum used.####\n## ******************************************************************** ##\nrad2deg <- function(rad) {(rad * 180) / (pi)}\n#create empty vector of average spectral angles for each species for within group variability \nsa_red <- c()\nsa_black <- c()\nsa_white <- c()\n\n\nfor(i in 1:20){\nsa_red[i] <- mean(sam(sp_red,sp_red[i,]), na.rm =TRUE)\n}\nmean(rad2deg(sa_red)) #3.1535\nsd(rad2deg(sa_red)) # 1.209211\nrange(rad2deg(sa_red)) #2.372152 8.028901\n\n\nfor(i in 1:20){\n  sa_black[i] <- mean(sam(sp_black,sp_black[i,]), na.rm =TRUE)\n}\nmean(rad2deg(sa_black)) #5.21\nsd(rad2deg(sa_black)) #  1.764257\nrange(rad2deg(sa_black)) # 3.689861 9.257968\n\nfor(i in 1:20){\n  sa_white[i] <- mean(sam(sp_white,sp_white[i,]), na.rm =TRUE)\n}\nmean(rad2deg(sa_white)) #3.150645\nsd(rad2deg(sa_white)) #0.6447496\nrange(rad2deg(sa_white)) #2.477099 4.800206\n\n#across group spectral angle variability \nb_r_dist <- c()\nr_b_dist <- c()\nb_w_dist <- c()\nr_w_dist <- c()\n\nfor(i in 1:20){\nb_r_dist[i] <- mean(sam(sp_red,\n                sp_black[i,]),na.rm=TRUE)\n}\nmean(rad2deg(b_r_dist)) #6.626706\nsd(rad2deg(b_r_dist)) #2.211052\nrange(rad2deg(b_r_dist)) #4.109806 12.244118\n\n\n#just to check that inverse is the same value\nfor(i in 1:20){\n  r_b_dist[i] <- mean(sam(sp_black,\n                          sp_red[i,]),na.rm=TRUE)\n}\nmean(b_r_dist) #0.1156578\n\n\n\nfor(i in 1:20){\n  b_w_dist[i] <- mean(sam(sp_black,\n                          sp_white[i,]),na.rm=TRUE)\n}\nmean(rad2deg(b_w_dist)) #6.243229\nsd(rad2deg(b_w_dist)) #0.9866146\nrange(rad2deg(b_w_dist)) #4.815639 8.227854\n\nfor(i in 1:20){\n  r_w_dist[i] <- mean(sam(sp_red,\n                          sp_white[i,]),na.rm=TRUE)\n}\nmean(rad2deg(r_w_dist)) # 3.68113\nsd(rad2deg(r_w_dist)) #0.7988784\nrange(rad2deg(r_w_dist)) #2.453275 5.374340\n\n## ******************************************************************** ##\n####Graphic of threshholding####\n## ******************************************************************** ##\n\nangle_thresh <- data.frame(\"species\" <- c(rep(\"red\", 20),rep(\"black\",20),rep(\"white\",20)),\n            \"angle\" <- c(rad2deg(sa_red),rad2deg(sa_black),rad2deg(sa_white)))\nggplot(angle_thresh, aes(angle, fill = species)) + \n  geom_histogram(alpha = .4, position = \"identity\") +\n  xlab('Spectral Angle (degrees)') + \n  ylab('Count') +\n  theme_tufte() +\n  guides(fill =  guide_legend(title=\"Species\")) +\n  theme(text = element_text(size=12, family = \"Helvetica\"),legend.position = c(.8,.55))\n\npng(\"mangrove_figures/species_spectra.png\")\n",
    "created" : 1569347121738.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1072733131",
    "id" : "CEE457E1",
    "lastKnownWriteTime" : 1572788286,
    "last_content_update" : 1572788286430,
    "path" : "~/Dropbox/Intellectual_Endeavours/UConn/Research/phd_research/chapter_2/mangroves_code/spectra_deriv_analysis.R",
    "project_path" : "spectra_deriv_analysis.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}